!function(){(function(){return window.performance?(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow).bind(window.performance):function(){return(new Date).getTime()}})().bind(window);var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}().bind(window),v={batchAppendViews:!1,staticHeights:!1,fastScrollingRate:30,scrollingSampleSize:10,destoryLag:3,drawAhead:3,drawTrigger:3},w=0,x={profile:!0,fps:!0},y=function(a,b){if(!(a[a.length-1]-a[0]<1e3)){var c,d,e,f=0,g=0;for(f=a[a.length-1]-a[0],c=f/a.length,d=a.length;a.length>1;)g=Math.max(a[1]-a.shift(),g);a.shift(),e=1e3/(f/d),console.log("%cfps:%c"+Math.min(60,e.toFixed(2))+"  %cmax:%c"+g.toFixed(2)+"ms"+"  %cavg:%c"+c.toFixed(2)+"ms "+b,"color: black;","color: red;","color: black;","color: red;","color: black;","color: red;")}},z=function(a){return a[a.length-1]-a[a.length-2]},A=[],B=null,C=void 0!==document.documentElement.style.webkitOverflowScrolling?!0:!1,D=function(a){return{set add(b){a+=b,1===b&&u(O)},get add(){return a}}}(0),E=[],F=document.createDocumentFragment(),G=0,H=function(a,b){var c;return 0!==a[0].scrollTop?a[0].scrollTop:(c=b.css("webkitTransform")||b.css("msTransform"),c=c.slice(c.lastIndexOf(",")+2,c.length-1),c=Math.abs(Number(c)),0===c&&(c=document.body.scrollTop),Math.abs(Number(c)))},I=function(a,b){var c,d,e,f,g=0;for(a._speed.length>v.scrollingSampleSize&&a._speed.shift(),a._speed.push(b),c=a._speed.length,d=0;c>d;d++)g+=a._speed[d];if(g/=c,a._isScrollingFast){if(a._isScrollingFast){if(g>0)return;console.log("fastscrolling: off "+g);for(e in a._pool){for(c=a._pool[e].length-1,r=c;r>-1;r--)f=a._pool[e][r],f._freezeAllocations(!0);for(c=a._dequeued[e].length-1,r=c;r>-1;r--)f=a._dequeued[e][r],f._saveMemoryMode=!0}a._isScrollingFast=!1}}else{if(g<v.fastScrollingRate)return;console.log("fastscrolling: on "+g),a._isScrollingFast=!0;for(e in a._pool){for(c=a._pool[e].length-1,r=c;r>-1;r--)f=a._pool[e][r],f._freezeAllocations(!1);for(c=a._dequeued[e].length-1,r=c;r>-1;r--)f=a._dequeued[e][r],f._freezeAllocations(!1)}}},J=function(a,b,c,d,e){var f,g,h,i,j,k,l;for(f in a._pool)for(g=a._pool[f].length-1,h=g;h>-1;h--)i=a._pool[f][h],j=i._idx,k=b[j],l=e?d>k:k>d,l&&(e?c[0]=Math.max(c[0],j):c[1]=Math.min(c[1],j),a._dequeued[f].push(i),a._pool[f].splice(h,1))},K=function(a,b,c,d,e){var f,g,h;for(h=Math.min(b.length,a[0]);b[h]<c&&d>h;)h++,void 0===b[h]&&(b[h]=0),b[h]||(f=e(h),b[h]=b[h-1]+f);g=a[0]>=a[1],g&&(a[1]=a[0]),b[a[1]]||(b[a[1]]=0)},L=function(a,b,c,d){var e,f,g;for(g=a[1];b[g]>c&&g>=0;)g--,void 0===b[g]&&(b[g]=0),b[g]||(e=d(g),b[g]=b[g+1]+e);f=a[1]<=a[0],f&&(a[0]=a[1])},M=function(a,b,c,d,e,f){var g,h,i,j,k=a._$items[0],l=v.batchAppendViews||v.staticHeights?function(){return a.estimateHeightAt(h)}:function(){return g.height()};for(e?(h=1,i=1,j=function(){return b[c[1]]<d&&c[1]<f}):(h=0,i=-1,j=function(){return b[c[0]]>d&&c[0]>-1});j();){if(g=a.repaint(c[h],b[c[h]]),!g)throw new Error("No ReuseView was returned from PoolView.render for idx "+c[1]+".");g._idx=c[h],g._top=b[c[h]],k.appendChild(g.$el[0]),c[h]+=i,b[c[h]]=b[c[h]-1]+l()}},N=function(a,b,c,d){var e=Number(a[0].style.height.split("px")[0]),f=b.length,g=f-1;if(f>=c||e<b[g]){var h=c-f;a[0].style.height=b[g]+h*b[b[1]]+"px",d&&d.refresh()}},O=function(r){for(r&&(A.push(r),y(A,r),s=r),a=E.length,q=0;a>q;q++)if(b=E[q],c=b._$container,$content=b._$content,d=b._$items,j=b._cursor,o=b._positionCache,g=H(c,$content),e=g>=G,h=c.height(),n=$content.height(),m=g+h,w++>10&&(p=Math.abs(g-G),I(b,p),w=0),G=g,e)l=g-h*v.destoryLag,k=Math.min(m+h*v.drawAhead,n),i=Math.min(m+h*v.drawTrigger,n),f=o[j[1]]<i,f&&(t=z(A),x.profile&&t>100&&console.profile("run-"+(s||0)),v.batchAppendViews&&F.appendChild($content[0]),J(b,o,j,l,!0),K(j,o,l,b.collection.length,b.estimateHeightAt),M(b,o,j,k,!0,b.collection.length),N($content,o,b.collection.length,B),v.batchAppendViews&&c[0].appendChild($content[0]),x.profile&&t>100&&console.profileEnd("run-"+s));else{if(l=m+h*v.destoryLag,k=g-h*v.drawAhead,i=m-h*v.drawTrigger,f=o[j[0]]>i,!f)continue;t=z(A),x.profile&&t>100&&console.profile("run-"+(s||0)),v.batchAppendViews&&F.appendChild($content[0]),J(b,o,j,l,!1),L(j,o,l,b.collection.length,b.estimateHeightAt),M(b,o,j,k,!1),N($content,o,b.collection.length,B),x.profile&&t>100&&console.profileEnd("run-"+(s||0)),v.batchAppendViews&&c.appendChild($content)}D&&u(O)};Backbone.PerfView=function(a){Backbone.View.prototype.constructor.apply(this,a),this.collection=a.collection,this._staticHeights=a.staticHeights||!1,E.push(this),this.render(),this._$container=this.$el.find(this.$container),0===this._$container.length&&(this._$container=this.$el),this._$container.css({position:"realtive",width:"100%"}),this._$container.css("-webkit-transform","translate3d(0,0,0)"),this._$content=$('<div id="scroller">'),this._$content.css("-webkit-transform","translate3d(0,0,0)"),this._$content.css({position:"absolute",width:"100%"}),this.$el.append(this._$content),this._$content.css("height",collection.length*this.estimateHeightAt(0)),this._$items=$('<div class="PoolViewItems" style="-webkit-transform: translate(0,0,0)">'),this._$content.append(this._$items),C&&window.IScroll?B=new IScroll(this._$container[0]):this._$container[0]===document.body?this._$container.css({height:"100%"}):this._$container.css({overflowY:"scroll",overflowX:"hidden"}),O(),D.add+=1},_.extend(Backbone.PerfView.prototype,{collection:null,_$container:null,_$content:null,_$items:null,_pool:{},_dequeued:{},_cursor:[0,0],_positionCache:[0],_speed:[],_staticHeights:!1,dequeueView:function(a,b,c){if(this._dequeued[a]=this._dequeued[a]||[],this._pool[a]=this._pool[a]||[],dequeue=this._dequeued[a].pop())return dequeue.model=c.model,this._pool[a].push(dequeue),dequeue;var d=new b(_.extend({staticHieght:this._staticHeights},c));return d._reuseId=a,this._pool[a].push(d),d},estimateHeightAt:function(){},remove:function(){}}),_.extend(Backbone.PerfView.prototype,Backbone.View.prototype),Backbone.PerfView.extend=Backbone.View.extend}(),function(){var a=/^img/,b=function(a){for(len=a.length,i=0;len>i;i++)a[i].src=null,a[i].src=""},c=Backbone.ReuseView=function(a){Backbone.View.prototype.constructor.apply(this,a),this.model=a.model||null,this.forceGPUTexture=a.forceGPUTexture||!1,this.render(),this.height=this.height?this.height:_.bind(this.$el.height,this.$el),this.$el.css(this.forceGPUTexture?{webkitTransform:"translate3d(0,0,0)"}:{position:"absolute"}),this._$cached={};for(var b in this.modelMap){var c=this.modelMap[b][0];this._$cached[b]=this.$el.find(c)}this._$imgs=this.$el.find("img"),this._repurpose(this.model)};_.extend(c.prototype,{model:null,modelMap:{},_reuseId:null,_$imgs:null,_$cached:{},_idx:null,_saveMemoryMode:!1,height:null,forceGPUTexture:!1,_repurpose:function(b){if(b&&this.model){for(name in this.modelMap)this.model.off("change:"+name);this.model=b}var c,d,e,f;for(name in this.modelMap)c=this.modelMap[name][0],this._saveMemoryMode&&a.exec(c)||(this._saveMemoryMode||this.model.on("change:"+name,_.bind(this._modelChanged,this)),d=this._$cached[name],e=this.model.get(name),f=this.modelMap[name][1],f.call(this,d,e))},repaint:function(a,c,d){var e=this.forceGPUTexture?{webkitTransform:"translate3d(0, "+c+"px, 0)"}:{top:c};this.$el.css(e),b(this._$imgs),this._repurpose(d)},staticHeight:function(){},_modelChanged:function(a){this._updateModel(this.model,Object.keys(a.changed)[0])},_updateModel:function(a,b){var c=this.modelMap[b][1];c(this._$cached[b],a.get(b))},_freezeAllocations:function(a){return this._saveMemoryMode=a,a?(this._repurpose(),void 0):b(this._$imgs)}}),_.extend(c.prototype,Backbone.View.prototype),c.extend=Backbone.View.extend}();